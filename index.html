<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>映画業界全体サマリーダッシュボード</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        :root {
            /* --- カラースキーム (低彩度・洗練) --- */
            --primary-color: #64748b;      /* キーカラー (Slate Blue) */
            --primary-light: #f1f5f9;     /* キーカラー (Light Gray Blue) */
            --primary-dark: #475569;      /* キーカラー (Dark Slate) */

            --text-primary: #1e293b;      /* 基本テキスト (Near Black) */
            --text-secondary: #475569;    /* サブテキスト (Dark Slate) */
            --text-light: #64748b;        /* ライトテキスト (Slate Blue) */
            --text-on-dark: #f8fafc;      /* 暗い背景用のテキスト色 */

            --bg-color: #f8fafc;          /* 全体背景 (Light Gray) */
            --card-bg: #ffffff;           /* カード背景 */
            --border-color: #e2e8f0;      /* 罫線 (Lighter Gray) */
            --border-dark-bg: #475569;    /* 暗い背景用のボーダー色 */

            --positive-color: #10b981;    /* ポジティブ (Emerald Green) */
            --negative-color: #f43f5e;    /* ネガティブ (Rose Red) */

            --active-kpi-bg: #FFF8E1;     /* アクティブKPIカード背景 (薄いベージュ) */

            /* --- グラフ用カラーパレット --- */
            --chart-color-1: #64748b; /* primary */
            --chart-color-2: #94a3b8; /* primaryLight adjusted */
            --chart-color-3: #5eead4; /* teal lighter */
            --chart-color-4: #7dd3fc; /* sky lighter */
            --chart-color-5: #c4b5fd; /* purple lighter */
            --chart-color-6: #fcd34d; /* amber lighter */
            --chart-positive: #10b981; /* positive */
            --chart-negative: #f43f5e; /* negative */
            --chart-gray: #cbd5e1;    /* gray */

            /* --- アイコン用カラー --- */
            --icon-color-blue: #3b82f6;
            --icon-bg-blue: #dbeafe;
            --icon-color-green: #10b981;
            --icon-bg-green: #d1fae5;
            --icon-color-red: #ef4444;
            --icon-bg-red: #fee2e2;
            --icon-color-purple: #8b5cf6;
            --icon-bg-purple: #ede9fe;
            --icon-color-yellow: #f59e0b;
            --icon-bg-yellow: #fef3c7;
            --icon-color-cyan: #06b6d4;
            --icon-bg-cyan: #cffafe;
            --icon-color-pink: #ec4899;
            --icon-bg-pink: #fce7f3;
            --icon-color-orange: #f97316;
            --icon-bg-orange: #ffedd5;
            --icon-color-teal: #14b8a6; /* ★ 新規: ティール (作品満足度グラフ用) */
            --icon-bg-teal: #ccfbf1;  /* ★ 新規: ティール背景 (作品満足度グラフ用) */
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        html {
           scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- コンテンツコンテナ --- */
        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0;
        }

        /* --- メインコンテンツ (サイドバーなし) --- */
        .main-content {
            margin-left: 0;
            padding-top: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- ヘッダー --- */
         .main-header {
            background-color: var(--card-bg);
            padding: 20px 32px;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        .main-header h1 {
            margin: 0;
            font-size: 1.65em;
            color: var(--text-primary);
            font-weight: 600;
            flex-shrink: 0;
        }
        .global-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .global-filters .filter-group {
            display: flex;
            flex-direction: column;
        }
        .global-filters label {
            font-size: 0.8em;
            color: var(--text-light);
            margin-bottom: 6px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .global-filters select,
        .global-filters input[type="date"] {
            padding: 9px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: #fff;
            font-size: 0.95em;
            font-family: inherit;
            color: var(--text-secondary);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .global-filters input[type="date"]::-webkit-calendar-picker-indicator {
            filter: none;
        }
        .global-filters select:hover,
        .global-filters input[type="date"]:hover {
            border-color: var(--primary-color);
        }
        .global-filters select:focus,
        .global-filters input[type="date"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(100, 116, 139, 0.2);
            outline: none;
        }

        /* --- コンテントエリア --- */
        .content-area {
            padding: 32px;
            flex-grow: 1;
        }

        /* --- セクションタイトル --- */
        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 24px 0;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }
        .content-area > .section-title:not(:first-child) {
            margin-top: 48px;
        }

        /* --- ダッシュボードグリッド --- */
        .dashboard-grid {
            display: grid;
            gap: 24px;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            margin-bottom: 24px;
        }
        .dashboard-grid.kpi-row {
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        .dashboard-grid.profile-row,
        .dashboard-grid.loyalty-row,
        .dashboard-grid.issues-row {
             grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        /* --- カードスタイル --- */
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03), 0 1px 2px rgba(0, 0, 0, 0.04);
            padding: 24px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease;
        }

        /* --- グラフカード用: アイコン付きタイトル --- */
        .card-title-with-icon {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        .card-title-with-icon .card-title {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            flex-grow: 1;
        }
        .icon-container {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .icon-container svg {
            width: 24px;
            height: 24px;
        }

        /* グラフカード用コンテント */
        .card-content {
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            flex-grow: 1;
            width: 100%;
            position: relative;
        }
        .card-content.list-content {
             align-items: stretch;
             min-height: 300px;
        }
        .card-content canvas {
            max-width: 100%;
            max-height: 100%;
        }


        /* --- KPIカードスタイル (最上段用) --- */
        .kpi-card-icon {
            flex-direction: row;
            align-items: center;
            gap: 20px;
            min-height: 100px;
            padding: 20px;
        }
        .kpi-card-icon .icon-container {
            width: 56px;
            height: 56px;
        }
        .kpi-card-icon .icon-container svg {
            width: 28px;
            height: 28px;
        }
        .kpi-card-icon .kpi-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* ★ Flexアイテムが縮むのを許可 */
        }
        .kpi-card-icon .kpi-label {
            /* ★ 1. フォントサイズ調整 */
            font-size: 0.85em;
            font-weight: 500;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.3; /* ★ 行間調整 */
        }
        .kpi-card-icon .kpi-value {
            font-size: 2.1em;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.1;
            margin-top: 4px;
        }
        .trend-button-kpi {
            margin-top: 8px;
            padding: 4px 8px;
            background-color: var(--primary-light);
            color: var(--primary-dark);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            align-self: flex-start;
            white-space: nowrap;
        }
        .trend-button-kpi:hover {
            background-color: var(--primary-color);
            color: var(--card-bg);
        }

        .kpi-card-icon.kpi-card-active {
            background-color: var(--active-kpi-bg);
        }


        /* アイコン色の定義 */
        .icon-container.bg-blue { background-color: var(--icon-bg-blue); }
        .icon-container.bg-blue svg { fill: var(--icon-color-blue); }
        .icon-container.bg-green { background-color: var(--icon-bg-green); }
        .icon-container.bg-green svg { fill: var(--icon-color-green); }
        .icon-container.bg-purple { background-color: var(--icon-bg-purple); }
        .icon-container.bg-purple svg { fill: var(--icon-color-purple); }
        .icon-container.bg-red { background-color: var(--icon-bg-red); }
        .icon-container.bg-red svg { fill: var(--icon-color-red); }
        .icon-container.bg-yellow { background-color: var(--icon-bg-yellow); }
        .icon-container.bg-yellow svg { fill: var(--icon-color-yellow); }
        .icon-container.bg-cyan { background-color: var(--icon-bg-cyan); }
        .icon-container.bg-cyan svg { fill: var(--icon-color-cyan); }
        .icon-container.bg-pink { background-color: var(--icon-bg-pink); }
        .icon-container.bg-pink svg { fill: var(--icon-color-pink); }
        .icon-container.bg-orange { background-color: var(--icon-bg-orange); }
        .icon-container.bg-orange svg { fill: var(--icon-color-orange); }
        .icon-container.bg-teal { background-color: var(--icon-bg-teal); } /* ★ 新規 */
        .icon-container.bg-teal svg { fill: var(--icon-color-teal); } /* ★ 新規 */


        /* --- Simple List Style --- */
        .simple-list {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
            text-align: left;
        }
        .simple-list li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
        }
         .simple-list li:last-child {
             border-bottom: none;
         }
        .simple-list .rank {
            font-weight: 600;
            color: var(--primary-color);
            margin-right: 10px;
            min-width: 18px;
            font-size: 0.85em;
        }
         .simple-list .item-label {
            flex-grow: 1;
            margin-right: 10px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
         }
         .simple-list .value {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
         }

        /* --- Text analysis placeholder --- */
        .text-analysis-placeholder {
            font-size: 1em;
            color: var(--text-light);
            line-height: 1.7;
            padding: 15px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            width: 100%;
            min-height: 150px;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: flex-start;
        }
         .text-analysis-placeholder span {
             display: inline-block;
             padding: 5px 10px;
             margin: 3px;
             background-color: var(--primary-light);
             color: var(--primary-dark);
             border-radius: 4px;
             font-weight: 500;
             font-size: 0.9em;
         }

        /* --- グリッドの列スパン --- */
        .col-span-full { grid-column: 1 / -1; }

        /* --- レスポンシブ対応 --- */
        @media (max-width: 1280px) {
             .dashboard-grid.kpi-row {
                 grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
             }
        }
        @media (max-width: 1024px) {
             .dashboard-grid { grid-template-columns: 1fr 1fr; }
             .col-span-full { grid-column: 1 / -1; }
              .dashboard-grid.kpi-row {
                 grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             }
              .dashboard-grid.profile-row,
              .dashboard-grid.loyalty-row,
              .dashboard-grid.issues-row {
                 grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 16px;
                flex-direction: column;
                align-items: flex-start;
            }
            .main-header h1 {
                font-size: 1.4em;
                margin-bottom: 16px;
            }
            .global-filters {
                width: 100%;
                justify-content: space-between;
            }
            .global-filters .filter-group {
                flex-grow: 1;
            }

            .content-area { padding: 16px; }
            .section-title { font-size: 1.3em; margin-bottom: 16px;}

            .dashboard-grid { grid-template-columns: 1fr; }
            .col-span-full { grid-column: span 1; }

             .dashboard-grid.kpi-row { grid-template-columns: 1fr; }

            .card-content { min-height: 250px; }
            .card-content.list-content { min-height: auto; }
            .kpi-value { font-size: 2em; }

            .kpi-card-icon {
                gap: 16px;
                padding: 16px;
            }
            .kpi-card-icon .icon-container {
                width: 48px;
                height: 48px;
            }
            .kpi-card-icon .icon-container svg {
                width: 24px;
                height: 24px;
            }
            .kpi-card-icon .kpi-value {
                font-size: 1.8em;
            }
            .trend-button-kpi {
                font-size: 0.7em;
                padding: 3px 6px;
            }

            .card-title-with-icon {
                gap: 12px;
                padding-bottom: 8px;
                margin-bottom: 16px;
            }
            .card-title-with-icon .icon-container {
                width: 40px;
                height: 40px;
            }
            .card-title-with-icon .icon-container svg {
                width: 20px;
                height: 20px;
            }
            .card-title-with-icon .card-title {
                font-size: 1.05em;
            }
        }
    </style>
</head>
<body>

    <div class="dashboard-container">

        <header class="main-header">
            <h1>映画業界全体サマリーダッシュボード</h1>
             <div class="global-filters">
                <div class="filter-group">
                    <label for="filter-period-start">集計期間（開始）</label>
                    <input type="date" id="filter-period-start" value="2025-10-01">
                </div>
                <div class="filter-group">
                    <label for="filter-period-end">集計期間（終了）</label>
                    <input type="date" id="filter-period-end" value="2025-10-25">
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="content-area">

                <!-- ========== セクション 1: KPIサマリー ========== -->
                <h2 class="section-title">KPIサマリー</h2>

                <div class="dashboard-grid kpi-row">
                     <!-- 作品 総合満足度 -->
                     <div class="card kpi-card-icon" id="kpi-card-work_satisfaction">
                        <div class="icon-container bg-teal"> <!-- 色変更 -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M15.115 2.147a.75.75 0 01.364.606v3.297a17.69 17.69 0 01-1.128.093c-2.484.18-4.93.987-7.002 2.311a.75.75 0 01-.698-.01l-2.03-1.015a.75.75 0 00-.834.019L2.147 8.115a.75.75 0 00-.606.364c-.366.65.048 1.442.72 1.776l1.62.81c1.11.555 2.298.814 3.486.745a16.118 16.118 0 004.83-.878l.044-.017c1.373-.553 2.131-1.843 2.131-3.256V2.753a.75.75 0 011.114-.606L18.86 3.86a.75.75 0 010 1.28l-2.09 1.045a.75.75 0 00-.211 1.05l1.045 2.09a.75.75 0 11-1.28.64l-1.045-2.09a.75.75 0 00-1.05-.211l-2.09 1.045a.75.75 0 01-1.026-.24l-1.3-2.34a.75.75 0 010-.84l1.3-2.34a.75.75 0 011.026-.24l2.09 1.045a.75.75 0 001.05-.211l1.045-2.09a.75.75 0 111.28.64l-1.045 2.09a.75.75 0 00-.211 1.05l2.09 1.045a.75.75 0 11-.64 1.28l-2.09-1.045a.75.75 0 00-1.05.211L11.5 13.5a.75.75 0 01-1 0l-1.638-1.17a17.64 17.64 0 01-4.01 1.006A17.69 17.69 0 014.75 16H2.753a.75.75 0 01-.606-.364C1.442 14.95.787 14.1 1.04 13.3l1.17-3.51a.75.75 0 01.393-.454l1.62-.81c.21-.105.448-.15.688-.13a16.118 16.118 0 004.83.878l.044.017c.563.228 1.15.39 1.758.483V6.05a.75.75 0 01-.606-.364L10.3 3.197a.75.75 0 01-.01-.698l1.015-2.03a.75.75 0 00-.019-.834L10.27.618a.75.75 0 00-1.052-.211L8.172 1.452a.75.75 0 01-1.05-.211L5.03 2.147a.75.75 0 00-.64-1.28L6.48.412a.75.75 0 011.052.21l1.045-1.045a.75.75 0 011.28.64l-1.045 2.09a.75.75 0 00.211 1.05l1.045 1.045a.75.75 0 11-.64 1.28L8.73 3.492a.75.75 0 00-1.05.211L6.635 5.794a.75.75 0 01-1.28-.64l1.045-2.09a.75.75 0 00-.211-1.05L5.145.97A.75.75 0 015.785 0L7.875.52a.75.75 0 01.454.394l1.17 3.51a.75.75 0 01-.13.688 16.17 16.17 0 00-3.486-.745c-1.898-.102-3.81.4-5.594 1.455l-1.62.81a.75.75 0 00-.364.606L.07 15.115a.75.75 0 00.606.885c.65.116 1.442.06 2.29-.12l.81-1.62a.75.75 0 01.606-.364h3.297c.032-1.353.356-2.684.93-3.957.574-1.272 1.398-2.42 2.396-3.385l.81-1.62a.75.75 0 01.885-.606l3.472 1.07a4 4 0 012.378-.962L15.115 2.147z" clip-rule="evenodd" /></svg>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">作品 総合満足度</div>
                            <div class="kpi-value">+45.0</div>
                            <button class="trend-button-kpi" data-kpi="work_satisfaction">推移グラフ →</button>
                        </div>
                    </div>

                    <!-- 劇場体験 総合満足度 -->
                    <div class="card kpi-card-icon" id="kpi-card-nps">
                        <div class="icon-container bg-blue">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.868 2.884c.321-.772 1.415-.772 1.736 0l1.681 4.06c.064.156.18.28.324.36l4.418 1.696c.784.3 1.121 1.268.549 1.91l-3.2 3.118a.64.64 0 00-.186.533l.754 4.398c.133.78-.68.14-1.36.14l-3.95-2.076a.638.638 0 00-.6 0l-3.95 2.076c-.68.36-1.493-.356-1.36-.14l.754-4.398a.64.64 0 00-.186-.533l-3.2-3.118c-.572-.642-.235-1.61.549-1.91l4.418-1.696a.64.64 0 00.324-.36l1.681-4.06z" clip-rule="evenodd" /></svg>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">劇場体験 総合満足度</div>
                            <div class="kpi-value">+15.2</div>
                            <button class="trend-button-kpi" data-kpi="nps">推移グラフ →</button>
                        </div>
                    </div>
                    <!-- 飲食購入率 -->
                    <div class="card kpi-card-icon" id="kpi-card-purchase">
                        <div class="icon-container bg-green">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.3 2.841A1.5 1.5 0 004.5 2.25H3a.75.75 0 000 1.5h1.5a.75.75 0 01.741.606L5.58 6.394a2.25 2.25 0 002.138 1.856h4.564a2.25 2.25 0 002.138-1.856l.339-1.696a.75.75 0 01.741-.606h1.5a.75.75 0 000-1.5h-1.5a1.5 1.5 0 00-1.794-.894L13.1 3.738a.75.75 0 01-.527-.92l.792-2.375a.75.75 0 00-1.42-.474l-.792 2.375a.75.75 0 01-.92.527L6.3 2.84zM5.25 10.5a.75.75 0 000 1.5h9.5a.75.75 0 000-1.5h-9.5zM3.873 13.803a1.5 1.5 0 00-1.474 1.765 1.5 1.5 0 001.474 1.182h12.254a1.5 1.5 0 001.474-1.182 1.5 1.5 0 00-1.474-1.765H3.873z" clip-rule="evenodd" /></svg>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">飲食購入率</div>
                            <div class="kpi-value">58.0%</div>
                            <button class="trend-button-kpi" data-kpi="purchase">推移グラフ →</button>
                        </div>
                    </div>
                    <!-- 休眠・新規来場比率 -->
                    <div class="card kpi-card-icon" id="kpi-card-new_lapsed">
                        <div class="icon-container bg-purple">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M11 5a3 3 0 11-6 0 3 3 0 016 0zM14 5a1 1 0 10-2 0 1 1 0 002 0zM16.34 8.04A2.5 2.5 0 0015 7.5a.75.75 0 00-1.5 0 2.5 2.5 0 00.16 1.007A4.49 4.49 0 0113 9.75a.75.75 0 000 1.5 4.49 4.49 0 011.16-1.243A2.5 2.5 0 0015 10.5a.75.75 0 001.5 0 2.5 2.5 0 00-1.66-2.46zM10 12.5a4.5 4.5 0 10-9 0 4.5 4.5 0 009 0zM8.5 10.5a.75.75 0 10-1.5 0v1.25H5.75a.75.75 0 100 1.5h1.25V14.5a.75.75 0 101.5 0v-1.25h1.25a.75.75 0 100-1.5H8.5v-1.25z" /></svg>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">休眠・新規来場比率</div>
                            <div class="kpi-value">13.0%</div>
                            <button class="trend-button-kpi" data-kpi="new_lapsed">推移グラフ →</button>
                        </div>
                    </div>
                    <!-- 高頻度来場比率 -->
                    <div class="card kpi-card-icon" id="kpi-card-high_freq">
                        <div class="icon-container bg-red">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zM4.5 8.25V15.25c0 .138.112.25.25.25h10.5a.25.25 0 00.25-.25V8.25H4.5z" clip-rule="evenodd" /></svg>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">高頻度来場比率</div>
                            <div class="kpi-value">50.0%</div>
                            <button class="trend-button-kpi" data-kpi="high_freq">推移グラフ →</button>
                        </div>
                    </div>
                    <!-- 「おひとりさま」鑑賞比率 -->
                    <div class="card kpi-card-icon" id="kpi-card-solo">
                        <div class="icon-container bg-yellow">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zM10 17.5c-2.67 0-5.19-.9-7.29-2.5C1.04 13.6 1 12.17 1 10.74 1 9.01 3.01 8 5.5 8c.31 0 .61.02.9.06A5.49 5.49 0 0110 9.5c1.54 0 2.94-.63 3.96-1.62.2.03.39.05.59.05 2.49 0 4.5.99 4.5 2.72 0 1.43-.04 2.86-1.71 4.26C15.19 16.6 12.67 17.5 10 17.5z" clip-rule="evenodd" /></svg>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">「おひとりさま」比率</div>
                            <div class="kpi-value">42.5%</div>
                            <button class="trend-button-kpi" data-kpi="solo">推移グラフ →</button>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                     <div class="card col-span-full">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-blue">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M12.383 3.654a.75.75 0 00-1.06.027l-2.5 3.5a.75.75 0 00.926 1.168l2.22-3.108 3.976 5.565a.75.75 0 00.926-.027l2.5-3.5a.75.75 0 00-.926-1.168L16 7.43l-3.617-5.063z" /><path fill-rule="evenodd" d="M3 3.75A.75.75 0 013.75 3h12.5a.75.75 0 010 1.5H3.75A.75.75 0 013 3.75zM3 7.75A.75.75 0 013.75 7h12.5a.75.75 0 010 1.5H3.75A.75.75 0 013 7.75zM3 11.75A.75.75 0 013.75 11h12.5a.75.75 0 010 1.5H3.75A.75.75 0 013 11.75zM3 15.75A.75.75 0 013.75 15h12.5a.75.75 0 010 1.5H3.75A.75.75 0 013 15.75z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title" id="kpiTrendChartTitle">NPS推移 (Q16)</h3>
                        </div>
                        <div class="card-content" style="min-height: 300px;">
                            <canvas id="kpiNpsTrendChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ========== セクション 2: 顧客プロファイル ========== -->
                <h2 class="section-title">顧客プロファイル</h2>

                <div class="dashboard-grid profile-row">
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.25 1.25 0 00-2.43 1.116A9.98 9.98 0 0010 18c2.61 0 5-1.005 6.965-2.67.665-.558.26-1.68-.616-1.68H3.465z" /></svg>
                            </div>
                            <h3 class="card-title">性別構成比 (Q28)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="profileGenderChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM3.064 6.4a.75.75 0 01.24-.974l1.25-1a.75.75 0 01.974 1.217l-1.25 1a.75.75 0 01-1.217-.243zm12.653.243a.75.75 0 01-.974 1.217l-1.25-1a.75.75 0 011.217-.974l1.25 1a.75.75 0 01-.243 1.217zM10 10a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /><path d="M12.695 10.368A4.5 4.5 0 0114.5 12.25v.25a.75.75 0 01-1.5 0v-.25a3 3 0 00-3-3H7.5a.75.75 0 010-1.5h2.5a.75.75 0 01.75.75 4.5 4.5 0 012.445-.868zM6.5 10.75a.75.75 0 01.75.75v.25a3 3 0 003 3h2.5a.75.75 0 010 1.5H10a4.5 4.5 0 01-4.5-4.5v-.25a.75.75 0 01.75-.75z" /><path fill-rule="evenodd" d="M3.003 12.356A3 3 0 015 11.5h1.618a.75.75 0 010 1.5H5a1.5 1.5 0 00-1.497 1.342A5.98 5.98 0 013 15.75v-1.895a.75.75 0 01.003-.099zm12.379-1.498A.75.75 0 0115 11.5h1.618a3 3 0 011.997.856.75.75 0 01-.003.099v1.895a5.98 5.98 0 01-2.003-1.457A1.5 1.5 0 0015 13H13.382a.75.75 0 010-1.5h1.997z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">年代構成比 (Q29)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="profileAgeChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 10A7 7 0 103 10c0 2.493 1.698 4.988 3.355 6.587.829.799 1.654 1.381 2.274 1.765.311.193.571.337.757.433.097.05.19.098.281.14l.018.008.006.003zM10 11.25a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">居住エリア Top5 (Q30)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="profileAreaChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.445c.393.09.77.218 1.121.381l.012.006c.86.383 1.643 1.284 1.83 2.29l.065.341c.326 1.713.326 3.42 0 5.132l-.065.34c-.187 1.007-.97 1.908-1.83 2.291l-.012.006a6.023 6.023 0 01-1.121.381v.445A2.75 2.75 0 0111.25 19h-2.5A2.75 2.75 0 016 16.25v-.445a6.023 6.023 0 01-1.121-.381l-.012-.006c-.86-.383-1.643-1.284-1.83-2.29l-.065-.34a7.001 7.001 0 010-5.132l.065-.34c.187-1.007.97-1.908 1.83-2.291l.012-.006c.351-.163.728-.29 1.121-.381V3.75zM8.75 3h2.5c.414 0 .75.336.75.75v.445a4.52 4.52 0 00-1.121.381l-.012.006c-.86.383-1.643 1.284-1.83 2.29l-.065.34a7.001 7.001 0 000 5.132l.065.34c.187 1.007.97 1.908 1.83 2.291l.012.006c.351.163.728.29 1.121.381v.445c0 .414-.336.75-.75.75h-2.5c-.414 0-.75-.336-.75-.75v-.445a4.52 4.52 0 00-1.121-.381l-.012-.006c-.86-.383-1.643-1.284-1.83-2.29l-.065-.34a7.001 7.001 0 010-5.132l.065-.34c.187-1.007.97-1.908 1.83-2.291l.012-.006c.351-.163.728-.29 1.121-.381V3.75c0-.414.336-.75.75-.75z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">主要な交通手段 (Q22)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="profileTransportChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">劇場までの移動時間 (Q23)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="profileTimeChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM10 15a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 15zM10 7a3 3 0 100 6 3 3 0 000-6zM15.657 5.404a.75.75 0 10-1.06-1.06l-1.061 1.06a.75.75 0 001.06 1.06l1.06-1.06zM5.404 15.657a.75.75 0 10-1.06-1.06l-1.06 1.061a.75.75 0 001.06 1.06l1.06-1.061zM17.25 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 01.75.75zM4.25 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 01.75.75zM14.596 15.657a.75.75 0 001.06-1.06l-1.06-1.061a.75.75 0 10-1.06 1.06l1.06 1.061zM4.343 5.404a.75.75 0 001.06-1.06l-1.06-1.06a.75.75 0 10-1.06 1.06l1.06 1.06z" /></svg>
                            </div>
                            <h3 class="card-title">1日の過ごし方 パターン (Q24)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="profilePlanChart"></canvas>
                        </div>
                    </div>
                     <div class="card">
                        <div class="card-title-with-icon">
                             <div class="icon-container bg-cyan">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3.75a.75.75 0 01.75.75v5.337c0 .123.024.242.07.353l3.358 4.701a.75.75 0 11-1.216.868l-3.358-4.701A.75.75 0 019.25 10.09V4.5a.75.75 0 01.75-.75z" /><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13.25a.75.75 0 00-1.5 0v6.5c0 .097.02.192.058.279l3.5 5a.75.75 0 001.21-.866l-3.5-5A.75.75 0 0010.75 11.25v-6.5z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">鑑賞頻度別 構成比 (Q19)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="kpiFreqChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card col-span-full">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zM4.5 8.25V15.25c0 .138.112.25.25.25h10.5a.25.25 0 00.25-.25V8.25H4.5z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">鑑賞日時パターン (Q5)</h3>
                        </div>
                        <div class="card-content" style="min-height: 250px;">
                            <canvas id="profileTimeSlotChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ========== セクション 3: ロイヤルティ・収益 ========== -->
                <h2 class="section-title">ロイヤルティ・収益</h2>

                <div class="dashboard-grid loyalty-row">
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-green">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M11.5 6.236a.75.75 0 01-1 0L3.58 3.308a.75.75 0 00-.912.51l-2.5 8A.75.75 0 00.98 12.5h.001a.75.75 0 00.742-.626l2.09-6.728L11 7.217l2.188-2.058 2.09 6.728a.75.75 0 00.742.626h.001a.75.75 0 00.812-.682l-2.5-8a.75.75 0 00-.912-.51L11.5 6.236z" /><path fill-rule="evenodd" d="M12.5 8.59a.75.75 0 011 0l4.25 3.036a.75.75 0 010 1.248l-4.25 3.036a.75.75 0 01-1 0V8.59zm-5 0a.75.75 0 00-1 0L2.25 11.626a.75.75 0 000 1.248l4.25 3.036a.75.75 0 001 0V8.59z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">メイン利用劇場シェア (Q20)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="loyaltyShareChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-green">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.5 3a.75.75 0 00-1.5 0v.258a3.984 3.984 0 00-1.32.704l-.066.059a.75.75 0 00.912 1.169l.066-.059A2.484 2.484 0 016.5 3.75V3zM13.5 3a.75.75 0 00-1.5 0v.258a3.984 3.984 0 00-1.32.704l-.066.059a.75.75 0 00.912 1.169l.066-.059A2.484 2.484 0 0113.5 3.75V3z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M3 6.5A2.5 2.5 0 015.5 4h9A2.5 2.5 0 0117 6.5v9A2.5 2.5 0 0114.5 18h-9A2.5 2.5 0 013 15.5v-9zM5.5 5.5A1 1 0 004.5 6.5v9A1 1 0 005.5 16.5h9A1 1 0 0015.5 15.5v-9A1 1 0 0014.5 5.5h-9zm3.03 4.28a.75.75 0 010 1.06l-1.5 1.5a.75.75 0 01-1.06-1.06l1.5-1.5a.75.75 0 011.06 0zm4.5 0a.75.75 0 010 1.06l-4.5 4.5a.75.75 0 01-1.06-1.06l4.5-4.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">劇場選定の重視点 Top 5 (Q21)</h3>
                        </div>
                        <div class="card-content list-content">
                            <ul class="simple-list">
                                 <li><span class="rank">1.</span> <span class="item-label">立地・アクセス</span> <span class="value">65%</span></li>
                                 <li><span class="rank">2.</span> <span class="item-label">上映時間</span> <span class="value">55%</span></li>
                                 <li><span class="rank">3.</span> <span class="item-label">スクリーンや音響などの設備</span> <span class="value">40%</span></li>
                                 <li><span class="rank">4.</span> <span class="item-label">チケット料金</span> <span class="value">35%</span></li>
                                 <li><span class="rank">5.</span> <span class="item-label">座席の快適さ</span> <span class="value">30%</span></li>
                                 <li><span class="rank">6.</span> <span class="item-label">上映作品のラインナップ</span> <span class="value">28%</span></li>
                                 <li><span class="rank">7.</span> <span class="item-label">会員サービス・割引</span> <span class="value">25%</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-green">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">今回劇場を選んだ理由 Top 5 (Q15)</h3>
                        </div>
                        <div class="card-content list-content">
                            <ul class="simple-list">
                                 <li><span class="rank">1.</span> <span class="item-label">立地が便利だから</span> <span class="value">50%</span></li>
                                 <li><span class="rank">2.</span> <span class="item-label">観たい時間の上映があったから</span> <span class="value">45%</span></li>
                                 <li><span class="rank">3.</span> <span class="item-label">いつも利用しているから</span> <span class="value">30%</span></li>
                                 <li><span class="rank">4.</span> <span class="item-label">特別な設備で観たかったから</span> <span class="value">25%</span></li>
                                 <li><span class="rank">5.</span> <span class="item-label">使いたい会員サービスがあったから</span> <span class="value">20%</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-green">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">鑑賞決定タイミング (Q6)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="revenueTimingChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ========== セクション 4: 課題と魅力 ========== -->
                <h2 class="section-title">課題と魅力</h2>

                <div class="dashboard-grid issues-row">
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-yellow">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2.5c-1.32 0-2.5.4-3.5 1.083-.997.68-1.805 1.62-2.395 2.688C3.51 7.28 3 8.62 3 10c0 1.38.51 2.72 1.105 3.729.59 1.068 1.4 2.007 2.395 2.688C7.5 17.1 8.68 17.5 10 17.5s2.5-.4 3.5-1.083c.997-.68 1.805-1.62 2.395-2.688C16.49 12.72 17 11.38 17 10c0-1.38-.51-2.72-1.105-3.729-.59-1.068-1.4-2.007-2.395-2.688C12.5 2.9 11.32 2.5 10 2.5zM10 4c.828 0 1.5.672 1.5 1.5S10.828 7 10 7s-1.5-.672-1.5-1.5S9.172 4 10 4zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 13c-.828 0-1.5.672-1.5 1.5S9.172 16 10 16s1.5-.672 1.5-1.5S10.828 13 10 13z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">映画館の魅力 Top 5 (Q26)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="issuesCharmRankChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-red">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.22 1.754a.75.75 0 011.56 0l.313 1.018a.75.75 0 01-.26 1.03l-.001.002-8.312 13.48a.75.75 0 01-1.287-.537l.001-.002C3.12 15.69 2.5 14.776 2.5 13.75a.75.75 0 011.5 0c0 .688.36 1.286.898 1.638l7.98-12.919A.75.75 0 018.22 1.754z" clip-rule="evenodd" /><path d="M10 3.125a.75.75 0 010 1.5A2.498 2.498 0 0011.898 2.51l7.98 12.919A4 4 0 0115.25 18H4.75a4 4 0 01-3.626-5.88l-1.07-3.472a.75.75 0 01.3-1.01l.001-.002 8.31-13.48A4 4 0 0110 3.125zM10 5.5a1 1 0 100-2 1 1 0 000 2zM10 7a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 0010 7z" /></svg>
                            </div>
                            <h3 class="card-title">鑑賞マナー懸念点 ワースト3 (Q27)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="issuesMannerRankChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-pink">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 001 1h14a1 1 0 001-1V4a1 1 0 00-1-1H3zm0 2h14v10H3V5zm2 2a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V8a1 1 0 00-1-1H5zm7 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V8a1 1 0 00-1-1h-2z" clip-rule="evenodd" /></svg>
                            </div>
                            <h3 class="card-title">「映画館で観たい」ジャンル (Q25)</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="issuesGenreRankChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card col-span-full">
                        <div class="card-title-with-icon">
                            <div class="icon-container bg-orange">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2c-1.751 0-3.41.4-4.92 1.152a.75.75 0 00-.517 1.082l.842 2.525a.75.75 0 001.33-.442L6.17 4.1a8.52 8.52 0 013.83 0l-.564 2.256a.75.75 0 001.33.442l.842-2.525a.75.75 0 00-.517-1.082C13.41 2.4 11.75 2 10 2zM3.053 6.38a.75.75 0 01-.013-1.06l1.22-1.22a.75.75 0 111.06 1.06l-1.22 1.22a.75.75 0 01-1.047 0zM15.74 5.32a.75.75 0 011.06 1.06l-1.22 1.22a.75.75 0 11-1.06-1.06l1.22-1.22z" clip-rule="evenodd" /><path d="M3.204 7.642a.75.75 0 01.028-1.06l1.006-1.006a.75.75 0 111.06 1.06l-1.006 1.006a.75.75 0 01-1.088-.001zM14.702 6.582a.75.75 0 111.06 1.06l-1.006 1.006a.75.75 0 11-1.06-1.06l1.006-1.006z" /><path d="M10 17c-4.064 0-7.53-2.672-8.383-6.168a.75.75 0 011.465-.364C3.784 13.56 6.603 15.5 10 15.5c3.397 0 6.216-1.94 6.918-4.932a.75.75 0 011.465.364C17.53 14.328 14.064 17 10 17z" /></svg>
                            </div>
                            <h3 class="card-title">劇場への意見・要望 (Q17) - テキスト分析</h3>
                        </div>
                        <div class="card-content text-analysis-placeholder">
                            <span style="font-size: 1.8em;">料金高い</span>
                            <span style="font-size: 1.4em;">空調寒い</span>
                            <span style="font-size: 1.5em;">清掃</span>
                            <span style="font-size: 1.2em;">ポップコーン味</span>
                            <span>トイレ綺麗</span>
                            <span style="font-size: 1.3em;">スタッフ対応</span>
                            <span>音量</span>
                            <span>予約システム</span>
                        </div>
                    </div>
                </div>

            </div> <!-- .content-area end -->
        </main> <!-- .main-content end -->
    </div> <!-- .dashboard-container end -->

    <script>
        /* --- Chart.js グローバル設定 --- */
        Chart.defaults.font.family = 'Inter, "Noto Sans JP", sans-serif';
        Chart.defaults.color = 'var(--text-secondary)';
        Chart.register(ChartDataLabels);

        /* --- チャートインスタンスを管理 --- */
        window.myCharts = {};

        /* --- グラフ配色 (CSS Variablesから取得) --- */
        function getCssVar(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }
        const chartColors = {
            primary: getCssVar('--chart-color-1'),
            primaryLight: getCssVar('--chart-color-2'),
            positive: getCssVar('--chart-positive'),
            negative: getCssVar('--chart-negative'),
            teal: getCssVar('--chart-color-3'),
            sky: getCssVar('--chart-color-4'),
            purple: getCssVar('--chart-color-5'),
            amber: getCssVar('--chart-color-6'),
            gray: getCssVar('--chart-gray')
        };


        /* --- デフォルトのグラフオプション --- */
        const defaultChartOptions = {
            responsive: true, maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { color: 'var(--text-secondary)', padding: 15, boxWidth: 10, usePointStyle: true, pointStyle: 'rectRounded' } },
                tooltip: { backgroundColor: 'rgba(30, 41, 59, 0.9)', titleColor: '#ffffff', bodyColor: '#e2e8f0', padding: 10, cornerRadius: 4, titleFont: { weight: '600' }, bodyFont: { weight: '500' } },
                datalabels: { display: false }
            },
            scales: {
                x: { ticks: { color: 'var(--text-light)', font: { size: 10 } }, grid: { display: false }, border: { display: false } },
                y: { ticks: { color: 'var(--text-light)', font: { size: 10 } }, grid: { color: 'var(--border-color)', drawBorder: false }, border: { display: false } }
            }
        };

        const horizontalBarOptions = {
            ...defaultChartOptions,
            indexAxis: 'y',
            barThickness: 16,
            scales: {
                x: { display: false },
                y: { ...defaultChartOptions.scales.y, grid: { display: false } }
            },
            plugins: {
                 ...defaultChartOptions.plugins,
                 datalabels: {
                     display: true, anchor: 'end', align: 'end', offset: -6, color: 'white',
                     font: { weight: 'bold', size: 11 },
                     formatter: (value, context) => value + '%'
                 }
            }
        };

        const pieDoughnutBaseOptions = {
             ...defaultChartOptions,
             elements: { arc: { borderWidth: 0 } },
             cutout: '70%'
        };
        const pieOptions = { ...pieDoughnutBaseOptions, cutout: '0%' };
        const doughnutOptions = { ...pieDoughnutBaseOptions };

        const barBaseOptions = {
            ...defaultChartOptions,
            elements: { bar: { borderRadius: 3 } },
            categoryPercentage: 0.6,
            barPercentage: 0.8
        };
        const barDefaultOptions = {
             ...barBaseOptions,
             plugins: {
                 ...barBaseOptions.plugins,
                 datalabels: {
                     display: true, anchor: 'end', align: 'top', offset: 4,
                     color: 'var(--text-secondary)', font: { size: 10 },
                     formatter: (value, context) => value + '%'
                 }
             }
        };
        const barHorizontalDefaultOptions = { ...horizontalBarOptions };
        const lineDefaultOptions = {
            ...defaultChartOptions,
            tension: 0.1,
            elements: { point:{ radius: 3 } },
            plugins: {
                ...defaultChartOptions.plugins,
                 // ★★★ 4. 折れ線グラフのデータラベル設定 ★★★
                 datalabels: {
                    display: true,      // 表示する
                    align: 'top',      // 点の上に表示
                    offset: 10,         // ★ 点からの距離を調整
                    backgroundColor: 'rgba(255, 255, 255, 0.7)', // 半透明の背景
                    borderRadius: 4,     // 角丸
                    color: 'var(--text-secondary)', // テキスト色
                    font: { size: 9 },  // フォントサイズ
                    padding: { top: 2, bottom: 1, left: 4, right: 4 }, // パディング
                    formatter: (value) => value.toFixed(1) // 小数点第一位まで表示
                }
            }
        };

        /* --- サンプル推移データ (24ヶ月分) --- */
        const trendLabels = [
            '23年11月', '23年12月', '24年1月', '24年2月', '24年3月', '24年4月', '24年5月', '24年6月',
            '24年7月', '24年8月', '24年9月', '24年10月', '24年11月', '24年12月', '25年1月', '25年2月',
            '25年3月', '25年4月', '25年5月', '25年6月', '25年7月', '25年8月', '25年9月', '25年10月'
        ];
        const trendData = {
            work_satisfaction: {
                label: '作品 総合満足度 推移',
                data: [40.0, 41.5, 42.0, 41.8, 42.5, 43.0, 43.5, 43.2, 44.0, 44.5, 44.2, 45.0, 44.8, 45.3, 45.1, 45.5, 46.0, 45.8, 46.2, 46.5, 46.8, 47.0, 46.7, 47.0],
                color: chartColors.teal // ★ 3. 色変更 (pink -> teal)
            },
            nps: {
                label: '劇場体験 総合満足度 推移 (Q16)', // ★ ラベル変更
                data: [11.5, 12.0, 11.8, 12.2, 12.5, 12.8, 13.0, 12.7, 13.3, 13.8, 13.5, 14.0, 13.7, 14.1, 13.9, 14.0, 14.5, 12.1, 13.5, 13.0, 14.2, 15.5, 14.8, 15.2],
                color: chartColors.primary
            },
            purchase: {
                label: '飲食購入率 推移 (%)',
                data: [55.0, 55.5, 56.0, 55.8, 56.2, 56.5, 57.0, 57.2, 57.5, 57.8, 58.0, 58.2, 58.5, 58.3, 57.8, 57.5, 57.0, 57.2, 57.5, 58.0, 58.5, 58.3, 57.9, 58.0],
                color: chartColors.positive
            },
            new_lapsed: {
                label: '休眠・新規来場比率 推移 (%)',
                data: [10.0, 10.5, 11.0, 10.8, 11.2, 11.5, 11.8, 12.0, 12.3, 12.5, 12.8, 13.0, 13.2, 13.5, 13.3, 13.0, 12.8, 12.5, 12.7, 12.9, 13.1, 13.3, 13.0, 13.0],
                color: chartColors.purple
            },
            high_freq: {
                label: '高頻度来場比率 推移 (%)',
                data: [40.0, 40.5, 41.0, 41.5, 42.0, 42.5, 43.0, 43.5, 44.0, 44.5, 45.0, 45.5, 46.0, 46.5, 47.0, 47.5, 48.0, 48.5, 49.0, 49.5, 49.8, 49.9, 50.1, 50.0],
                color: chartColors.negative
            },
            solo: {
                label: '「おひとりさま」比率 推移 (%)',
                data: [38.0, 38.2, 38.5, 38.3, 38.7, 39.0, 39.3, 39.5, 39.8, 40.0, 40.2, 40.5, 40.8, 41.0, 41.2, 41.5, 41.8, 42.0, 42.2, 42.4, 42.6, 42.8, 42.5, 42.5],
                color: chartColors.amber
            }
        };

        /* --- 推移グラフ更新関数 --- */
        function updateTrendChart(kpiType) {
            const chartInstance = window.myCharts.kpiNpsTrendChart;
            const dataSet = trendData[kpiType];
            const titleElement = document.getElementById('kpiTrendChartTitle');

            if (chartInstance && dataSet && titleElement) {
                chartInstance.data.labels = trendLabels;
                chartInstance.data.datasets[0].label = dataSet.label.split(' ')[0];
                chartInstance.data.datasets[0].data = dataSet.data;
                chartInstance.data.datasets[0].borderColor = dataSet.color;
                chartInstance.data.datasets[0].backgroundColor = dataSet.color;
                chartInstance.update();
                titleElement.textContent = dataSet.label;
            } else {
                console.error("Could not update trend chart. Instance, data, or title element not found.", {kpiType, chartInstance, dataSet, titleElement});
            }
        }


        /* --- グラフ初期化関数 --- */

        function initKpiCharts() {
            // 推移グラフ (折れ線グラフ)
            try {
                if (!window.myCharts.kpiNpsTrendChart) {
                    const ctx = document.getElementById('kpiNpsTrendChart').getContext('2d');
                    const initialKpi = 'work_satisfaction';
                    window.myCharts.kpiNpsTrendChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: trendLabels,
                            datasets: [{
                                label: trendData[initialKpi].label.split(' ')[0],
                                data: trendData[initialKpi].data,
                                borderColor: trendData[initialKpi].color,
                                backgroundColor: trendData[initialKpi].color,
                                borderWidth: 2
                            }]
                        },
                        options: {
                             ...lineDefaultOptions,
                             plugins: {
                                 legend: { display: false },
                                 datalabels: lineDefaultOptions.plugins.datalabels
                             },
                             scales: {
                                 x: {
                                     ticks: {
                                         color: 'var(--text-light)', font: { size: 9 },
                                         maxRotation: 45, minRotation: 0,
                                         autoSkip: true, maxTicksLimit: 12
                                     },
                                     grid: { display: false }, border: { display: false }
                                 },
                                 y: {
                                     ticks: { color: 'var(--text-light)', font: { size: 10 } },
                                     // ★ 2. Y軸グリッドの色を薄く
                                     grid: { color: 'rgba(226, 232, 240, 0.5)', drawBorder: false },
                                     border: { display: false }
                                 }
                             }
                        }
                    });
                    const titleElement = document.getElementById('kpiTrendChartTitle');
                    if(titleElement) titleElement.textContent = trendData[initialKpi].label;
                }
            } catch (e) { console.error("Failed to init kpiNpsTrendChart", e); }
        }

        function initProfileCharts() {
            // 性別 (ドーナツ)
            try {
                if (!window.myCharts.profileGenderChart) {
                    const ctx = document.getElementById('profileGenderChart').getContext('2d');
                    window.myCharts.profileGenderChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['男性', '女性', '他'], datasets: [{ data: [48, 50, 2], backgroundColor: [chartColors.primary, chartColors.purple, chartColors.gray] }] }, options: doughnutOptions });
                }
            } catch (e) { console.error("Failed to init profileGenderChart", e); }

            // 年代 (棒)
            try {
                if (!window.myCharts.profileAgeChart) {
                    const ctx = document.getElementById('profileAgeChart').getContext('2d');
                    window.myCharts.profileAgeChart = new Chart(ctx, { type: 'bar', data: { labels: ['10代', '20代', '30代', '40代', '50代', '60代+'], datasets: [{ label: '構成比', data: [12, 25, 20, 18, 15, 10], backgroundColor: chartColors.teal }] }, options: { ...barDefaultOptions, plugins: { ...barDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init profileAgeChart", e); }

            // エリア (横棒)
            try {
                if (!window.myCharts.profileAreaChart) {
                    const ctx = document.getElementById('profileAreaChart').getContext('2d');
                    window.myCharts.profileAreaChart = new Chart(ctx, { type: 'bar', data: { labels: ['東京都', '神奈川県', '埼玉県', '千葉県', '大阪府'], datasets: [{ label: '構成比', data: [30, 20, 15, 12, 8], backgroundColor: chartColors.primary }] }, options: { ...barHorizontalDefaultOptions, plugins: { ...barHorizontalDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init profileAreaChart", e); }

            // 交通手段 (ドーナツ)
            try {
                if (!window.myCharts.profileTransportChart) {
                    const ctx = document.getElementById('profileTransportChart').getContext('2d');
                    window.myCharts.profileTransportChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: { labels: ['公共交通機関', '自家用車', '徒歩', '自転車'], datasets: [{ data: [50, 30, 10, 8], backgroundColor: [chartColors.primary, chartColors.teal, chartColors.primaryLight, chartColors.sky] }] },
                        options: doughnutOptions
                    });
                }
            } catch (e) { console.error("Failed to init profileTransportChart", e); }

            // 移動時間 (棒)
            try {
                if (!window.myCharts.profileTimeChart) {
                    const ctx = document.getElementById('profileTimeChart').getContext('2d');
                    window.myCharts.profileTimeChart = new Chart(ctx, { type: 'bar', data: { labels: ['10分以内', '10-30分', '30-60分', '60-90分', '90分以上'], datasets: [{ label: '構成比', data: [15, 40, 30, 10, 5], backgroundColor: chartColors.primaryLight, borderWidth: 0 }] }, options: { ...barDefaultOptions, plugins: { ...barDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init profileTimeChart", e); }

            // 1日の過ごし方 (ドーナツ)
            try {
                if (!window.myCharts.profilePlanChart) {
                    const ctx = document.getElementById('profilePlanChart').getContext('2d');
                    window.myCharts.profilePlanChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: { labels: ['映画のみ', '後に飲食等', '前に飲食等', 'その他'], datasets: [{ data: [40, 35, 20, 5], backgroundColor: [chartColors.primary, chartColors.purple, chartColors.sky, chartColors.gray] }] },
                        options: doughnutOptions
                    });
                }
            } catch (e) { console.error("Failed to init profilePlanChart", e); }

             // 鑑賞頻度グラフ (ドーナツ)
            try {
                if (!window.myCharts.kpiFreqChart) {
                    const ctx = document.getElementById('kpiFreqChart').getContext('2d');
                    window.myCharts.kpiFreqChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['ライト層 (年1-4回)', 'ミドル層 (年5-11回)', 'コア層 (年12回+)'],
                            datasets: [{
                                data: [45, 30, 25],
                                backgroundColor: ['#D2B48C', '#A0522D', '#8B4513']
                            }]
                        },
                        options: doughnutOptions
                    });
                }
            } catch (e) { console.error("Failed to init kpiFreqChart", e); }


            // 鑑賞日時 (棒)
            try {
                if (!window.myCharts.profileTimeSlotChart) {
                    const ctx = document.getElementById('profileTimeSlotChart').getContext('2d');
                    window.myCharts.profileTimeSlotChart = new Chart(ctx, { type: 'bar', data: { labels: ['平日午前', '平日午後', '平日夜', '休日午前', '休日午後', '休日夜'], datasets: [{ label: '来場比率', data: [5, 10, 20, 15, 30, 20], backgroundColor: chartColors.primaryLight }] }, options: { ...barDefaultOptions, plugins: { ...barDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init profileTimeSlotChart", e); }
        }

        function initLoyaltyCharts() {
            // メイン劇場 (棒)
            try {
                if (!window.myCharts.loyaltyShareChart) {
                    const ctx = document.getElementById('loyaltyShareChart').getContext('2d');
                    window.myCharts.loyaltyShareChart = new Chart(ctx, { type: 'bar', data: { labels: ['TOHO', 'イオン', 'UC', '109', 'MOVIX', 'Tジョイ', '他', '未定'], datasets: [{ label: 'シェア', data: [30, 20, 15, 8, 7, 5, 5, 10], backgroundColor: chartColors.primary }] }, options: { ...barDefaultOptions, plugins: { ...barDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init loyaltyShareChart", e); }
        }

        function initRevenueCharts() {
            // 決定タイミング (ドーナツ)
            try {
                if (!window.myCharts.revenueTimingChart) {
                    const ctx = document.getElementById('revenueTimingChart').getContext('2d');
                    window.myCharts.revenueTimingChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['当日', '2-3日前', '1週間前', 'それ以上前'], datasets: [{ data: [30, 40, 20, 10], backgroundColor: [chartColors.sky, chartColors.primary, chartColors.primaryLight, chartColors.gray] }] }, options: doughnutOptions });
                }
            } catch (e) { console.error("Failed to init revenueTimingChart", e); }
        }

        function initIssuesCharts() {
            // 魅力 (横棒)
            try {
                if (!window.myCharts.issuesCharmRankChart) {
                    const ctx = document.getElementById('issuesCharmRankChart').getContext('2d');
                    window.myCharts.issuesCharmRankChart = new Chart(ctx, { type: 'bar', data: { labels: ['没入感', '集中環境', 'イベント感', '一体感', 'その他'], datasets: [{ label: '魅力度', data: [75, 55, 30, 10, 5], backgroundColor: chartColors.primary }] }, options: { ...barHorizontalDefaultOptions, plugins: { ...barHorizontalDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init issuesCharmRankChart", e); }

            // マナー (横棒)
            try {
                if (!window.myCharts.issuesMannerRankChart) {
                    const ctx = document.getElementById('issuesMannerRankChart').getContext('2d');
                    window.myCharts.issuesMannerRankChart = new Chart(ctx, { type: 'bar', data: { labels: ['おしゃべり', 'スマホ光', '座席キック', '飲食音/匂'], datasets: [{ label: '懸念度', data: [65, 50, 30, 20], backgroundColor: chartColors.negative }] }, options: { ...barHorizontalDefaultOptions, plugins: { ...barHorizontalDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init issuesMannerRankChart", e); }

            // ジャンル (横棒)
            try {
                if (!window.myCharts.issuesGenreRankChart) {
                    const ctx = document.getElementById('issuesGenreRankChart').getContext('2d');
                    window.myCharts.issuesGenreRankChart = new Chart(ctx, { type: 'bar', data: { labels: ['アクション', 'SF/ファンタジー', 'アニメ', 'ミュージカル', 'サスペンス'], datasets: [{ label: '観たい度', data: [60, 58, 45, 30, 25], backgroundColor: chartColors.teal }] }, options: { ...barHorizontalDefaultOptions, plugins: { ...barHorizontalDefaultOptions.plugins, legend: { display: false } } } });
                }
            } catch (e) { console.error("Failed to init issuesGenreRankChart", e); }
        }


        /* --- ページ読み込み時にすべてのグラフを初期化 --- */
        document.addEventListener('DOMContentLoaded', () => {
            initKpiCharts();
            initProfileCharts();
            initLoyaltyCharts();
            initRevenueCharts();
            initIssuesCharts();

            // ★ 初期アクティブカードを設定
            const initialKpiCard = document.getElementById('kpi-card-work_satisfaction'); // 初期は作品満足度
            if (initialKpiCard) {
                initialKpiCard.classList.add('kpi-card-active');
            }

            // 推移グラフボタンのイベントリスナー
            const kpiRow = document.querySelector('.dashboard-grid.kpi-row');
            if (kpiRow) {
                kpiRow.addEventListener('click', (event) => {
                    const button = event.target.closest('.trend-button-kpi'); // ボタン自体か、その子要素か
                    if (button) {
                        const kpiType = button.dataset.kpi;
                        if (kpiType) {
                            // ★ アクティブクラスの管理
                            const allKpiCards = kpiRow.querySelectorAll('.kpi-card-icon');
                            allKpiCards.forEach(card => card.classList.remove('kpi-card-active'));

                            const clickedCard = button.closest('.kpi-card-icon');
                            if(clickedCard) {
                                clickedCard.classList.add('kpi-card-active');
                            }

                            updateTrendChart(kpiType);
                        }
                    }
                });
            } else {
                 console.error("KPI row element not found for attaching event listeners.");
            }
        });

    </script>
</body>
</html>
